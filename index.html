<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Passenger Survey</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 700px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }
    .header img {
      width: 70px;
      margin-right: 15px;
    }
    .header h2 {
      margin: 0;
    }
    .info-banner {
      background: #e6f7ff;
      padding: 10px;
      border-left: 5px solid #1890ff;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      font-size: 1em;
    }
    .submit-btn {
      background: green;
      color: white;
      padding: 10px;
      font-size: 1em;
      border: none;
      width: 100%;
      border-radius: 5px;
      cursor: pointer;
    }
    .spinner {
      text-align: center;
      margin-top: 10px;
      display: none;
    }
    .rtl {
      direction: rtl;
      text-align: right;
    }
    .lang-switch {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="logo.png" alt="Logo">
      <h2 id="formTitle">üöå Passenger Feedback Survey</h2>
    </div>

    <div class="info-banner" id="gpsNote">
      üìç Please enable GPS. It helps us improve public transport in your area.
    </div>

    <div class="lang-switch">
      üåê <label for="langSelect" style="font-weight: bold;">Select Language:</label>
      <select id="langSelect" onchange="changeLanguage()">
        <option value="en">English</option>
        <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
        <option value="ur">ÿßÿ±ÿØŸà</option>
      </select>
    </div>

    <form id="surveyForm">
      <div class="form-group"><label id="q1Label" for="q1">1. How satisfied are you with the service?</label>
        <select id="q1" name="q1" required>
          <option value="">-- Select --</option>
          <option>Very satisfied</option>
          <option>Satisfied</option>
          <option>Neutral</option>
          <option>Unsatisfied</option>
        </select>
      </div>

      <div class="form-group"><label id="q2Label" for="q2">2. What is the purpose of your trip?</label>
        <input type="text" id="q2" name="q2" required>
      </div>

      <div class="form-group"><label id="q3Label" for="q3">3. How often do you use public transport?</label>
        <select id="q3" name="q3" required>
          <option value="">-- Select --</option>
          <option>Daily</option>
          <option>Weekly</option>
          <option>Monthly</option>
          <option>Rarely</option>
        </select>
      </div>

      <div class="form-group"><label id="q4Label" for="q4">4. Gender</label>
        <select id="q4" name="q4" required>
          <option value="">-- Select --</option>
          <option>Male</option>
          <option>Female</option>
          <option>Prefer not to say</option>
        </select>
      </div>

      <div class="form-group"><label id="q5Label" for="q5">5. Your age group</label>
        <select id="q5" name="q5" required>
          <option value="">-- Select --</option>
          <option>Under 18</option>
          <option>18-25</option>
          <option>26-40</option>
          <option>41-60</option>
          <option>60+</option>
        </select>
      </div>

      <input type="hidden" name="latitude" id="latitude">
      <input type="hidden" name="longitude" id="longitude">

      <button class="submit-btn" type="submit">Submit</button>
      <div class="spinner" id="spinner"><img src="https://i.imgur.com/llF5iyg.gif" width="40"/></div>
    </form>
  </div>

<script>
const translations = {
  en: {
    title: "üöå Passenger Feedback Survey",
    gps: "üìç Please enable GPS. It helps us improve public transport in your area.",
    q1: "1. How satisfied are you with the service?",
    q2: "2. What is the purpose of your trip?",
    q3: "3. How often do you use public transport?",
    q4: "4. Gender",
    q5: "5. Your age group",
    safari: "üì± You're using Safari on iPhone.
üìç Please allow location access.
Settings ‚Üí Safari ‚Üí Location ‚Üí Allow."
  },
  ar: {
    title: "üöå ÿßÿ≥ÿ™ÿ®ŸäÿßŸÜ ÿ±ÿ∂ÿß ÿßŸÑÿ±ŸÉÿßÿ®",
    gps: "üìç ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ™ŸÖŸÉŸäŸÜ GPS ŸÑÿ™ÿ≠ÿ≥ŸäŸÜ ÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÜŸÇŸÑ ÿßŸÑÿπÿßŸÖ ŸÅŸä ŸÖŸÜÿ∑ŸÇÿ™ŸÉ.",
    q1: "1. ŸÖÿß ŸÖÿØŸâ ÿ±ÿ∂ÿßŸÉ ÿπŸÜ ÿßŸÑÿÆÿØŸÖÿ©ÿü",
    q2: "2. ŸÖÿß ŸáŸà ÿßŸÑÿ∫ÿ±ÿ∂ ŸÖŸÜ ÿ±ÿ≠ŸÑÿ™ŸÉÿü",
    q3: "3. ŸÉŸÖ ŸÖÿ±ÿ© ÿ™ÿ≥ÿ™ÿÆÿØŸÖ Ÿàÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÜŸÇŸÑ ÿßŸÑÿπÿßŸÖÿü",
    q4: "4. ÿßŸÑÿ¨ŸÜÿ≥",
    q5: "5. ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑÿπŸÖÿ±Ÿäÿ©",
    safari: "üì± ÿ™ÿ≥ÿ™ÿÆÿØŸÖ Safari ÿπŸÑŸâ iPhone.
üìç ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ™ŸÖŸÉŸäŸÜ ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖŸàŸÇÿπ.
ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ ‚Üí Safari ‚Üí ÿßŸÑŸÖŸàŸÇÿπ ‚Üí ÿßŸÑÿ≥ŸÖÿßÿ≠"
  },
  ur: {
    title: "üöå ŸÖÿ≥ÿßŸÅÿ± ⁄©€å ÿ±ÿßÿ¶€í ⁄©ÿß ÿ≥ÿ±Ÿà€í",
    gps: "üìç ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ GPS ⁄©Ÿà ŸÅÿπÿßŸÑ ⁄©ÿ±€å⁄∫ ÿ™ÿß⁄©€Å €ÅŸÖ ÿ¢Ÿæ ⁄©€í ÿπŸÑÿßŸÇ€í ŸÖ€å⁄∫ Ÿæÿ®ŸÑ⁄© Ÿπÿ±ÿßŸÜÿ≥ŸæŸàÿ±Ÿπ ⁄©Ÿà ÿ®€Åÿ™ÿ± ÿ®ŸÜÿß ÿ≥⁄©€å⁄∫€î",
    q1: "1. ÿ¢Ÿæ ÿ≥ÿ±Ÿàÿ≥ ÿ≥€í ⁄©ÿ™ŸÜ€í ŸÖÿ∑ŸÖÿ¶ŸÜ €Å€å⁄∫ÿü",
    q2: "2. ÿ¢Ÿæ ⁄©€í ÿ≥ŸÅÿ± ⁄©ÿß ŸÖŸÇÿµÿØ ⁄©€åÿß €Å€íÿü",
    q3: "3. ÿ¢Ÿæ ⁄©ÿ™ŸÜ€å ÿ®ÿßÿ± Ÿæÿ®ŸÑ⁄© Ÿπÿ±ÿßŸÜÿ≥ŸæŸàÿ±Ÿπ ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ⁄©ÿ±ÿ™€í €Å€å⁄∫ÿü",
    q4: "4. ÿ¨ŸÜÿ≥",
    q5: "5. ÿ¢Ÿæ ⁄©€å ÿπŸÖÿ± ⁄©ÿß ⁄Øÿ±ŸàŸæ",
    safari: "üì± ÿ¢Ÿæ iPhone Safari ÿßÿ≥ÿ™ÿπŸÖÿßŸÑ ⁄©ÿ± ÿ±€Å€í €Å€å⁄∫€î
üìç ÿ®ÿ±ÿß€Å ⁄©ÿ±ŸÖ ŸÑŸà⁄©€åÿ¥ŸÜ ⁄©€å ÿßÿ¨ÿßÿ≤ÿ™ ÿØ€å⁄∫€î
Settings ‚Üí Safari ‚Üí Location ‚Üí Allow"
  }
};

function changeLanguage() {
  const lang = document.getElementById("langSelect").value;
  const t = translations[lang];
  document.body.dir = lang === "ar" || lang === "ur" ? "rtl" : "ltr";

  document.getElementById("formTitle").innerText = t.title;
  document.getElementById("gpsNote").innerText = t.gps;
  document.getElementById("q1Label").innerText = t.q1;
  document.getElementById("q2Label").innerText = t.q2;
  document.getElementById("q3Label").innerText = t.q3;
  document.getElementById("q4Label").innerText = t.q4;
  document.getElementById("q5Label").innerText = t.q5;
}

function detectiPhoneSafari(lang) {
  const isIOS = /iP(hone|od|ad)/.test(navigator.platform);
  const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
  if (isIOS && isSafari) {
    alert(translations[lang].safari);
  }
}

window.onload = () => {
  const browserLang = navigator.language.slice(0, 2);
  const selectedLang = ["en", "ar", "ur"].includes(browserLang) ? browserLang : "en";
  document.getElementById("langSelect").value = selectedLang;
  changeLanguage();
  detectiPhoneSafari(selectedLang);
  captureLocation();
};

function captureLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        document.getElementById("latitude").value = position.coords.latitude;
        document.getElementById("longitude").value = position.coords.longitude;
      },
      () => {
        alert("üìç Please enable GPS and reload the page.");
      }
    );
  }
}

document.getElementById("surveyForm").addEventListener("submit", async function(e) {
  e.preventDefault();
  const lat = document.getElementById("latitude").value;
  const lng = document.getElementById("longitude").value;
  if (!lat || !lng) {
    alert("‚ùå GPS location not available. Please allow GPS access.");
    return;
  }
  document.getElementById("spinner").style.display = "block";
  const formData = new FormData(this);
  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbzE9RBdLsOaNdo_nJ-6o4deMCp9VnCuBar8dRhd5LvNlMhdxiR5LmqkJZTCyUe3omWD/exec", {
      method: "POST",
      body: formData
    });
    if (res.ok) {
      alert("‚úÖ Submitted successfully!");
      this.reset();
    } else throw new Error("Network error");
  } catch {
    alert("‚ùå Submission failed. Please try again.");
  }
  document.getElementById("spinner").style.display = "none";
});
</script>
</body>
</html>
